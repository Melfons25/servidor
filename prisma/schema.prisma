// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================================
// MODELOS DE LA BIBLIOTECA
// ===================================

model Usuario {
  id               Int       @id @default(autoincrement())
  nombre           String
  apellido         String
  
  // Nuevos campos requeridos:
  fechaNacimiento  DateTime 
  email            String    @unique 
  
  prestamos        Prestamo[]
}

model Libro {
  id               Int       @id @default(autoincrement())
  titulo           String    @unique
  isbn             String    @unique
  fechaPublicacion DateTime
  
  prestamos        Prestamo[]
  autores          Libro_Autor[]
  
  // Relación Uno a Uno con Inventario (el signo '?' significa que es opcional)
  inventario       Inventario?
}

model Autor {
  id               Int           @id @default(autoincrement())
  nombre           String
  apellido         String
  
  libros           Libro_Autor[]
}

// TABLA DE UNIÓN para la relación N:M entre Libro y Autor
model Libro_Autor {
  libroId          Int
  autorId          Int
  
  libro            Libro         @relation(fields: [libroId], references: [id])
  autor            Autor         @relation(fields: [autorId], references: [id])
  
  @@id([libroId, autorId])
}

// TABLA DE TRANSACCIONES para la relación 1:N entre Usuario/Libro y Prestamo
model Prestamo {
  id               Int       @id @default(autoincrement())
  
  usuarioId        Int
  libroId          Int
  
  fechaPrestamo    DateTime  @default(now())
  fechaDevolucionEstimada DateTime
  fechaDevolucionReal     DateTime? // El signo '?' significa que puede ser nulo
  
  usuario          Usuario   @relation(fields: [usuarioId], references: [id])
  libro            Libro     @relation(fields: [libroId], references: [id])
}

// NUEVA TABLA para normalizar las copias disponibles (Relación 1:1)
model Inventario {
  id                  Int     @id @default(autoincrement())
  copiasDisponibles   Int     
  
  // Clave Foránea ÚNICA que la enlaza a Libro (esto define la relación 1:1)
  libroId             Int     @unique
  libro               Libro   @relation(fields: [libroId], references: [id])
}